# Query Optimization and Physical Storage in DBMS

---

## What is Query Optimization?

Query Optimization means improving a SQL query so that:

* It runs faster
* Uses less memory and CPU
* Reads less data from disk

In real applications, the same query may run thousands of times, so even small improvements matter a lot.

---

## Why is Query Optimization Important?

Without optimization:

* Queries become slow as data grows
* Applications feel laggy
* Server resources get wasted

With optimization:

* Faster response time
* Better user experience
* Efficient use of database resources

---

## 1. Use Indexes Efficiently

### What is an Index?

An index works like the index of a book.

* Without index → database reads every row (full table scan)
* With index → database jumps directly to required rows

### Where should you use indexes?

Create indexes on columns used in:

* WHERE
* JOIN
* ORDER BY
* GROUP BY

### Example

**Without index:**

```sql
SELECT * FROM Employees WHERE EmpID = 101;
```

Database checks every employee.

**With index on EmpID:**

* Database directly finds employee 101
* Much faster

**Key idea:**
Indexes help the database find data quickly instead of searching everything.

---

## 2. Select Only Necessary Columns (Avoid SELECT *)

### Why avoid SELECT *?

SELECT * fetches all columns, even if you don’t need them.

This:

* Transfers more data
* Uses more memory
* Slows down execution

### Example

**Bad:**

```sql
SELECT * FROM Employees;
```

**Good:**

```sql
SELECT EmpID, Name FROM Employees;
```

**Key idea:**
Only ask for what you need. Less data = faster query.

---

## 3. Optimize JOIN Operations

### What happens in JOIN?

JOIN combines rows from multiple tables.
If not optimized, JOINs can be very slow, especially on large tables.

### Best practices

* Use the correct JOIN type (INNER, LEFT, etc.)
* Join using indexed columns
* Avoid unnecessary tables in JOINs

### Example

```sql
SELECT e.Name, d.DeptName
FROM Employees e
INNER JOIN Departments d
ON e.DeptID = d.DeptID;
```

If `DeptID` is indexed:

* Database matches rows quickly

**Key idea:**
Efficient JOINs reduce comparisons and speed up query execution.

---

## 4. Partition Large Tables

### What is Partitioning?

Partitioning means splitting a large table into smaller parts based on some condition.

### Example partitions

* By date
* By region
* By year

### Why is partitioning useful?

Instead of scanning the entire table:

* Database scans only the required partition

### Example

Table: `Sales`

Partitioned by year (2022, 2023, 2024)

Query:

```sql
SELECT * FROM Sales WHERE Year = 2024;
```

Database:

* Reads only 2024 partition
* Ignores other years

**Key idea:**
Partitioning reduces disk I/O and improves performance for large tables.

---

## 5. Cache Query Results

### What is Caching?

Caching means storing the result of a query so it can be reused.

### Why cache?

If the same query runs repeatedly:

* No need to calculate results again
* Just return stored result

### Example

Query:

```sql
SELECT COUNT(*) FROM Orders;
```

If cached:

* First run → calculates and stores result
* Next runs → directly returns stored value

**Key idea:**
Caching avoids repeated work and speeds up frequently used queries.

---

## Final Summary (Easy to Remember)

* Indexes → Find data faster
* Avoid SELECT * → Fetch less data
* Optimized JOINs → Faster table matching
* Partitioning → Scan only required data
* Caching → Reuse results, save time

---

# What is Physical Storage?

Physical storage refers to how and where data is actually stored inside a computer system.

Databases do not store data magically —
they store data physically on storage devices, mainly disks.

---

## Types of Storage Devices

There are three main types of storage based on speed, cost, and purpose.

---

## 1. Primary Storage

### What is Primary Storage?

Primary storage is the fastest memory that the CPU can access directly.

### Examples

* Main Memory (RAM)
* Cache Memory

### Characteristics

* Very fast
* Very expensive
* Volatile (data is lost if power goes off)
* Used for temporary data

### Example

If your system crashes or power fails:

* Data in RAM is lost
* Data on disk remains safe

**Key idea:**
Primary storage is fast but temporary.

---

## 2. Secondary Storage

### What is Secondary Storage?

Secondary storage is used to store data permanently.

### Examples

* Hard Disk (HDD)
* Solid State Drive (SSD / Flash Memory)

### Characteristics

* Slower than RAM
* Non-volatile (data is not lost when power is off)
* Stores database files, tables, indexes

### Example

* Employee records in a database
* Customer details stored for years

**Key idea:**
Secondary storage keeps data safe for long-term use.

---

## 3. Tertiary Storage

### What is Tertiary Storage?

Used mainly for backup and archival purposes.

### Examples

* Optical Disks (CD/DVD)
* Magnetic Tapes

### Characteristics

* Very slow
* Cheap for large data
* Used for offline storage

### Example

* Old database backups
* Historical data storage

**Key idea:**
Tertiary storage is for backup, not daily operations.

---

## How Databases Store Data Physically

* Databases store data as files on disk
* Each table or index may have:

  * One file
  * Or multiple files
* Each file contains a sequence of records

So internally:

```
Database → Files → Blocks → Records
```

---

## RAM vs Hard Disk Access Speed

### RAM

* Access time: nanoseconds
* Data is accessed using memory addresses
* Cache memory further speeds up access
* Very fast but temporary

### Hard Disk

* Access time: milliseconds
* Uses mechanical parts
* Data access involves:

  * Moving read/write head
  * Waiting for disk rotation

Much slower than RAM

**Key idea:**
RAM is thousands of times faster than disk storage.

---

## How Data is Accessed During Program Execution

1. Program requests data
2. System checks RAM first
3. If data is found in RAM → fast access
4. If not found:

   * Data is loaded from disk into RAM
   * Then accessed by the program

### In DBMS

* Index files are stored on disk
* Frequently used index pages are kept in RAM

This improves query performance

**Key idea:**
DBMS uses RAM as a buffer to speed up disk operations.

---

## How Files Are Organized on Disk

### Disk is divided into Blocks

* Disk is divided into fixed-size blocks
* Each block stores multiple records

### Formula

```
Number of records per block =
Size of block / Size of record
```

### Example

* Block size = 4 KB
* Record size = 400 bytes

```
Records per block = 4096 / 400 ≈ 10
```

---

## File Allocation on Hard Disk

* Files are stored in contiguous blocks

This reduces:

* Fragmentation
* Disk head movement

Improves read/write speed

**Key idea:**
Contiguous allocation improves performance.

---

## How Records Are Stored in Files

Records can be stored in two ways:

### 1. Sorted Records

* Records stored in sorted order (by key)
* Searching is fast
* Insertion is slow (need to maintain order)

**Example:**

* Student records sorted by Roll Number

**Best for:**
Read-heavy systems

---

### 2. Unsorted Records

* Records stored in random order
* Searching is slow
* Insertion is fast

**Example:**

* Log records added continuously

**Best for:**
Insert-heavy systems

---

## Final Summary (Exam-Friendly)

* Primary storage → Fast, volatile, temporary (RAM, cache)
* Secondary storage → Slow, non-volatile, permanent (HDD, SSD)
* Tertiary storage → Backup and archive (tape, optical disk)
* Databases store data as files on disk
* Data is loaded into RAM for faster access
* Disk is divided into blocks, blocks store records
* Files use contiguous allocation
* Records can be sorted or unsorted
